<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <base href="/"> -->
    <meta charset="UTF-8">
    <title>Address</title>
    <style type="text/css">
        .btn{
            width:500px;
            height:120px;
            font-size:50px;
        }
    </style>
    <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
    <script type="text/javascript">
        function register()
        {
            $.ajax({
                url: 'http://www.lifeuxuan.com/backend/WxAddressCtrl.php',
                type: 'GET',
                dataType: 'json',
                data:{
                    'url': window.location.href
                }
            })
            .done(function(e)
            {   
                // var res = JSON.parse(e);
                var rs = e;
                wx.config({
                    debug:false,
                    appId:rs.appId,
                    timestamp:rs.timestamp,
                    nonceStr:rs.nonceStr,
                    signature:rs.signature,
                    jsApiList:['checkJsApi','openAddress']
                });
                wx.error(function(res)
                {
                });
            })
            .fail(function(e)
            {
            })
            .always(function()
            {
            });

        }

        function ForwardAddress()
        {
            wx.ready(function(){
                wx.openAddress({
                    success:function(res)
                    {
                        var addr = '';
                        for(var x in res)
                        {
                            addr += x + "=" + res[x];
                        }
                        alert(addr);
                    },
                    cancel:function(){
                        alert("fa");
                    }
                });
            });
        }

        function ForwardPay()
        {
            
            $.ajax({
                url: 'http://www.lifeuxuan.com/backend/wxpay/pay/WxPayCtrl.php',
                type: 'GET',
                dataType: 'json',
                data: {
                    //'openId': 'oDHyIvznjdxR2KFmyAjWMs2S0lyU',
                    'payMoney': '1'
                }
            })
            .done(function(e)
            {
                var res = JSON.parse(e);
                wx.ready(function(){
                    wx.chooseWXPay(
                    {
                        timestamp: res.timeStamp,
                        nonceStr: res.nonceStr,
                        package: res.package,
                        signType: res.signType,
                        paySign: res.paySign,
                        success:function(res)
                        {
                            alert('pay success');
                        }
                    });
                });
            
            })
            .fail(function(e)
            {
            })
            .always(function()
            {
            });
        }

        function ForwardUserInfo()
        {
            $.ajax({
                url: 'http://www.lifeuxuan.com/backend/userinfo.php?XDEBUG_SESSION_START=657409A8',
                type: 'GET',
                dataType: 'json',
                data: {
                }
            })
            .done(function(e)
            {
                //alert(e);
                var res = JSON.parse(e);
                for(var x in res)
                {
                    alert(x + "=" + res[x]);
                }
                
            })
            .fail(function(e)
            {
                alert(e);
            });
        }

        function SendCheckCode()
        {
            $.ajax({
                url: 'http://www.lifeuxuan.com/backend/api/SendCheckCode.php?XDEBUG_SESSION_START=657409A8',
                type: 'GET',
                dataType: 'json',
                data: {
                    'longitude': 121.444444,
                    'latitude': 31.29874,
                    'userPhoneNumber': '15921308675'
                }
            })
            .done(function (e) {
                //alert(e);
                //var res = JSON.parse(e);
                //for (var x in res) {
                    //alert(x + "=" + res[x]);
                //}
                alert(e['msg']);
                window.check_code = e['msg'];

            })
            .fail(function (e) {
                alert(e);
            });
        }

        function CheckCheckCode()
        {
            code = $('#code').val();
            alert(code);
            $.ajax({
                url: 'http://www.lifeuxuan.com/backend/api/CheckCheckCode.php?XDEBUG_SESSION_START=657409A8',
                type: 'GET',
                dataType: 'json',
                data: {
                    'longitude': 121.444444,
                    'latitude': 31.29874,
                    'userPhoneNumber': '15921308675',
                    'checkCode':code
                }
            })
            .done(function (e) {
                alert(e['msg']);
            })
            .fail(function (e) {
                alert(e);
            });
        }

        register();
    </script>
</head>
<body>
    <div align="center">
        <button name="Pay" class="btn" onclick="ForwardPay()">前往支付</button><br/><br/><br/>
        <button name="Address" class="btn" onclick="ForwardAddress()">前往地址</button><br/><br/><br/>
        <button name="UserInfo" class="btn" onclick="ForwardUserInfo()">获取用户信息</button><br/><br/><br/>
        <button name="SendCode" class="btn" onclick="SendCheckCode()">发送验证码</button><br /><br /><br />
        <button name="CheckCode" class="btn" onclick="CheckCheckCode()">验证验证码</button><br /><br /><br />
        <input type="text" id="code" class="btn" /><br /><br /><br />
    </div>

</body>
</html>
